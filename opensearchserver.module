<?php
/**
 * Implements hook_init()
 */
function opensearchserver_init() {
//check if the opensearchserver library is present in the libraries folder
  if (module_exists('libraries')) {
    $library = libraries_get_path('opensearchserver');
    require_once $library .'/oss_api.class.php';
    require_once $library .'/oss_misc.lib.php';
    require_once $library .'/oss_indexdocument.class.php';
    require_once $library .'/oss_results.class.php';
    require_once $library .'/oss_paging.class.php';
    require_once $library .'/oss_search.class.php';
    require_once $library .'/oss_searchtemplate.class.php';
    require_once $library .'/oss_delete.class.php';
    //Add the autocomplete javascript
    drupal_add_js(drupal_get_path('module', 'OpenSearchServer') . '/js/opensearchserver.js');
    $vars['scripts'] = drupal_get_js();
    //Adding include files
    require_once 'opensearchserver_admin.inc';
    require_once 'opensearchserver_search.inc';
    require_once 'opensearchserver_autocomplete.inc';
  }
  else {
    $msg= 'The OpenSearchServer library could not be found Or The Library API not found.';
    drupal_set_message(check_plain($msg), $type = 'error');
    return FALSE;
  }
}

/**
 * Implements hook_perm()
 */
function opensearchserver_perm() {
  return array('access opensearchserver admin', 'access opensearchserver search');
}

/**
 * Implements hook_menu()
 */
function opensearchserver_menu() {
  $items = array();
  $items['admin/settings/opensearchserver'] = array(
    'title'  => 'OpenSearchServer',
    'description'  => t('Settings to access the OpenSearchServer instance from drupal.'),
    'page callback'  => 'drupal_get_form',
    'page arguments'  => array('opensearchserver_admin'),
    'access arguments' => array('access administration pages'),
    'access arguments'  =>  array('access opensearchserver admin'),
  );
  $items['opensearchserver'] = array(
    'title'   => 'OpenSearchServer Search',
    'description'  => t('This module will integrate OpenSearchServer 1.2 as search engine for Drupal 6.x.x'),
    'page callback'  => 'opensearchserver_search',
    'access arguments'  => array('access opensearchserver search'),
  );
  $items['opensearchserver/autocomplete'] = array(
    'title' => 'Autocomplete for cities',
    'page callback' => 'opensearchserver_autocomplete',
    'access arguments' => array('access opensearchserver search'),
    'type' => MENU_CALLBACK
  );
  return $items;
}